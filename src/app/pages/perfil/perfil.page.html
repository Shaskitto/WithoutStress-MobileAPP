<ion-content [fullscreen]="true" class="perfil-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Perfil</ion-title>
    </ion-toolbar>
  </ion-header>

  <ng-container *ngIf="!isEditing; else editMode">
    <ion-card class="perfil-card">
      <ion-card-header class="perfil-card-header">
        <ion-card-title class="perfil-card-title">Información del Usuario</ion-card-title>
      </ion-card-header>      

      <ion-card-content>
        <div class="perfil-img-container">
          <ion-img [src]="user?.profileImage" *ngIf="user?.profileImage"
                   class="perfil-img"></ion-img>
          <ion-text *ngIf="!user?.profileImage" color="medium">
            No se ha establecido ninguna imagen de perfil.
          </ion-text>
        </div>

        <!-- Información Personal -->
        <ion-item>
          <ion-label>Nombre de Usuario:</ion-label>
          <ion-text>{{ user?.username }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Correo Electrónico:</ion-label>
          <ion-text>{{ user?.email }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Edad:</ion-label>
          <ion-text>{{ user?.edad }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Sexo:</ion-label>
          <ion-text>{{ user?.sexo }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Semestre:</ion-label>
          <ion-text>{{ user?.semestre }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Carrera:</ion-label>
          <ion-text>{{ user?.carrera }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label>Actividades:</ion-label>
          <ion-text>{{ user?.actividades.join(', ') }}</ion-text>
        </ion-item>

        <!-- Horarios -->
        <ion-item>
          <ion-label>Horario:</ion-label>
          <ion-text>
            Mañana: {{ user?.horario?.manana.join(', ') }}<br>
            Tarde: {{ user?.horario?.tarde.join(', ') }}<br>
            Noche: {{ user?.horario?.noche.join(', ') }}
          </ion-text>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Botones de Acción -->
    <ion-button expand="block" color="primary" (click)="toggleEdit()">
      {{ isEditing ? 'Cancelar' : 'Editar' }}
    </ion-button>
    <ion-button expand="block" color="danger" (click)="logout()">Cerrar sesión</ion-button>
  </ng-container>

  <!-- Modo de Edición -->
  <ng-template #editMode>
    <form [formGroup]="perfilForm" (ngSubmit)="updateUser()">
      <ion-item>
        <ion-label position="floating">Nombre de Usuario</ion-label>
        <ion-input formControlName="username"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Imagen de Perfil</ion-label>
        <ion-input type="file" (change)="onFileSelected($event)"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Edad</ion-label>
        <ion-input formControlName="edad" type="number"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Sexo</ion-label>
        <ion-select formControlName="sexo">
          <ion-select-option value="Masculino">Masculino</ion-select-option>
          <ion-select-option value="Femenino">Femenino</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Semestre</ion-label>
        <ion-select formControlName="semestre">
          <ion-select-option *ngFor="let i of [1, 2, 3, 4]" [value]="i">{{ i }}</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Carrera</ion-label>
        <ion-select formControlName="carrera">
          <ion-select-option value="Ingeniería de Sistemas">Ingeniería de Sistemas</ion-select-option>
          <ion-select-option value="Ingeniería Multimedia">Ingeniería Multimedia</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Actividades</ion-label>
        <ion-select formControlName="actividades" multiple="true">
          <ion-select-option value="Meditación">Meditación</ion-select-option>
          <ion-select-option value="Sonidos Relajantes">Sonidos Relajantes</ion-select-option>
          <ion-select-option value="Ejercicios de respiración">Ejercicios de respiración</ion-select-option>
          <ion-select-option value="Prácticas para Dormir">Prácticas para Dormir</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Edición de Horarios -->
      <ng-container formGroupName="horario">
        <ion-item>
          <ion-label position="floating">Horario Mañana</ion-label>
          <ion-select formControlName="manana" multiple="true">
            <ion-select-option *ngFor="let hour of ['06:00', '07:00', '08:00', '09:00', '10:00', '11:00']" [value]="hour">{{ hour }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Horario Tarde</ion-label>
          <ion-select formControlName="tarde" multiple="true">
            <ion-select-option *ngFor="let hour of ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00']" [value]="hour">{{ hour }}</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Horario Noche</ion-label>
          <ion-select formControlName="noche" multiple="true">
            <ion-select-option *ngFor="let hour of ['18:00', '19:00', '20:00', '21:00', '22:00', '23:00']" [value]="hour">{{ hour }}</ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>

      <!-- Botones de Acción -->
      <ion-button expand="block" type="submit" [disabled]="!perfilForm.valid">
        Guardar Cambios
      </ion-button>

      <ion-button expand="block" color="medium" (click)="toggleEdit()">
        Cancelar
      </ion-button>
    </form>
  </ng-template>
</ion-content>
